<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini AI å›¾åƒç”Ÿæˆæµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .container {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        input, textarea, select, button {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #555;
            border-radius: 4px;
            background: #333;
            color: white;
        }
        button {
            background: #007bff;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #555;
            cursor: not-allowed;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .image-result {
            text-align: center;
            margin-top: 20px;
        }
        .image-result img {
            max-width: 100%;
            border: 2px solid #555;
            border-radius: 8px;
        }
        .loading {
            text-align: center;
            padding: 20px;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
        }
        .tab {
            flex: 1;
            padding: 10px;
            background: #333;
            border: 1px solid #555;
            cursor: pointer;
            text-align: center;
        }
        .tab.active {
            background: #007bff;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <h1>ğŸ¨ Gemini AI å›¾åƒç”Ÿæˆæµ‹è¯•</h1>
    
    <div class="tabs">
        <div class="tab active" onclick="switchTab('text-to-image')">æ–‡ç”Ÿå›¾</div>
        <div class="tab" onclick="switchTab('image-to-image')">å›¾ç”Ÿå›¾</div>
        <div class="tab" onclick="switchTab('test-api')">APIæµ‹è¯•</div>
    </div>

    <!-- æ–‡ç”Ÿå›¾æµ‹è¯• -->
    <div id="text-to-image" class="tab-content active">
        <div class="container">
            <h2>æ–‡ç”Ÿå›¾æµ‹è¯•</h2>
            <textarea id="textPrompt" placeholder="æè¿°ä½ æƒ³è¦çš„çº¹èº«è®¾è®¡..." rows="3">A traditional dragon tattoo design with intricate details, black and white, suitable for arm placement</textarea>
            
            <button onclick="generateTextToImage()" id="textBtn">ç”Ÿæˆå›¾åƒ</button>
            
            <div id="textResult"></div>
        </div>
    </div>

    <!-- å›¾ç”Ÿå›¾æµ‹è¯• -->
    <div id="image-to-image" class="tab-content">
        <div class="container">
            <h2>å›¾ç”Ÿå›¾æµ‹è¯•</h2>
            <input type="file" id="imageFile" accept="image/*">
            <textarea id="imagePrompt" placeholder="æè¿°å¦‚ä½•ä¿®æ”¹å›¾åƒ..." rows="3">Transform this into a traditional tattoo style with bold outlines</textarea>
            
            <button onclick="generateImageToImage()" id="imageBtn">ç”Ÿæˆå›¾åƒ</button>
            
            <div id="imageResult"></div>
        </div>
    </div>

    <!-- APIæµ‹è¯• -->
    <div id="test-api" class="tab-content">
        <div class="container">
            <h2>APIè¿æ¥æµ‹è¯•</h2>
            <button onclick="testApiConnection()" id="testBtn">æµ‹è¯•APIè¿æ¥</button>
            <div id="testResult"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://inkgeniusapi.digworldai.com/api/gemini';
        // const API_BASE = 'http://localhost:8080/api/gemini'; // æœ¬åœ°æµ‹è¯•

        function switchTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function showLoading(elementId) {
            document.getElementById(elementId).innerHTML = `
                <div class="loading">
                    <p>ğŸ”„ ç”Ÿæˆä¸­ï¼Œè¯·ç¨å€™...</p>
                </div>
            `;
        }

        function showResult(elementId, success, message, imageData = null) {
            const resultClass = success ? 'success' : 'error';
            let html = `<div class="result ${resultClass}">${message}</div>`;
            
            if (success && imageData) {
                html += `
                    <div class="image-result">
                        <img src="${imageData}" alt="Generated Image">
                        <br>
                        <a href="${imageData}" download="generated-tattoo.png">
                            <button style="width: auto; margin-top: 10px;">ä¸‹è½½å›¾åƒ</button>
                        </a>
                    </div>
                `;
            }
            
            document.getElementById(elementId).innerHTML = html;
        }

        async function generateTextToImage() {
            const prompt = document.getElementById('textPrompt').value.trim();
            const btn = document.getElementById('textBtn');
            
            if (!prompt) {
                showResult('textResult', false, 'è¯·è¾“å…¥æè¿°æ–‡å­—');
                return;
            }
            
            btn.disabled = true;
            btn.textContent = 'ç”Ÿæˆä¸­...';
            showLoading('textResult');
            
            try {
                const response = await fetch(`${API_BASE}/text-to-image`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        // æ³¨æ„ï¼šå®é™…ä½¿ç”¨æ—¶éœ€è¦æ·»åŠ è®¤è¯token
                        // 'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        prompt,
                        width: 512,
                        height: 512
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showResult('textResult', true, 'âœ… å›¾åƒç”ŸæˆæˆåŠŸï¼', result.imageData);
                } else {
                    showResult('textResult', false, `âŒ ç”Ÿæˆå¤±è´¥: ${result.message || result.error}`);
                }
            } catch (error) {
                showResult('textResult', false, `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`);
            } finally {
                btn.disabled = false;
                btn.textContent = 'ç”Ÿæˆå›¾åƒ';
            }
        }

        async function generateImageToImage() {
            const fileInput = document.getElementById('imageFile');
            const prompt = document.getElementById('imagePrompt').value.trim();
            const btn = document.getElementById('imageBtn');
            
            if (!fileInput.files[0]) {
                showResult('imageResult', false, 'è¯·é€‰æ‹©å›¾åƒæ–‡ä»¶');
                return;
            }
            
            if (!prompt) {
                showResult('imageResult', false, 'è¯·è¾“å…¥ä¿®æ”¹æè¿°');
                return;
            }
            
            btn.disabled = true;
            btn.textContent = 'ç”Ÿæˆä¸­...';
            showLoading('imageResult');
            
            try {
                const formData = new FormData();
                formData.append('image', fileInput.files[0]);
                formData.append('prompt', prompt);
                formData.append('strength', '0.7');
                formData.append('width', '512');
                formData.append('height', '512');
                
                const response = await fetch(`${API_BASE}/image-to-image`, {
                    method: 'POST',
                    headers: {
                        // æ³¨æ„ï¼šå®é™…ä½¿ç”¨æ—¶éœ€è¦æ·»åŠ è®¤è¯token
                        // 'Authorization': `Bearer ${token}`
                    },
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showResult('imageResult', true, 'âœ… å›¾åƒç”ŸæˆæˆåŠŸï¼', result.imageData);
                } else {
                    showResult('imageResult', false, `âŒ ç”Ÿæˆå¤±è´¥: ${result.message || result.error}`);
                }
            } catch (error) {
                showResult('imageResult', false, `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`);
            } finally {
                btn.disabled = false;
                btn.textContent = 'ç”Ÿæˆå›¾åƒ';
            }
        }

        async function testApiConnection() {
            const btn = document.getElementById('testBtn');
            btn.disabled = true;
            btn.textContent = 'æµ‹è¯•ä¸­...';
            
            try {
                const response = await fetch(`${API_BASE}/test`);
                const result = await response.json();
                
                if (result.success) {
                    showResult('testResult', true, `âœ… APIè¿æ¥æˆåŠŸï¼
                        <br>è¿æ¥çŠ¶æ€: ${result.data.connected ? 'å·²è¿æ¥' : 'æœªè¿æ¥'}
                        <br>APIå¯†é’¥: ${result.data.config.hasApiKey ? 'å·²é…ç½®' : 'æœªé…ç½®'}
                        <br>é¡¹ç›®ID: ${result.data.config.projectId}
                        <br>æ¨¡å‹: ${JSON.stringify(result.data.config.models)}`);
                } else {
                    showResult('testResult', false, `âŒ APIæµ‹è¯•å¤±è´¥: ${result.message}`);
                }
            } catch (error) {
                showResult('testResult', false, `âŒ è¿æ¥å¤±è´¥: ${error.message}`);
            } finally {
                btn.disabled = false;
                btn.textContent = 'æµ‹è¯•APIè¿æ¥';
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•APIè¿æ¥
        window.onload = function() {
            console.log('ğŸš€ Gemini AI å›¾åƒç”Ÿæˆæµ‹è¯•é¡µé¢å·²åŠ è½½');
            console.log('ğŸ“¡ APIç«¯ç‚¹:', API_BASE);
        };
    </script>
</body>
</html>