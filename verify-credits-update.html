<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éªŒè¯ç§¯åˆ†æ›´æ–°</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .info {
            background: #e3f2fd;
            color: #0c5460;
            border: 1px solid #bee5eb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .button {
            display: inline-block;
            margin: 10px 5px;
            padding: 12px 24px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            text-decoration: none;
            font-size: 14px;
        }
        .button:hover {
            background: #0056b3;
        }
        .button.success { background: #28a745; }
        .button.success:hover { background: #1e7e34; }
        .code {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            margin: 10px 0;
        }
        .result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” éªŒè¯ç§¯åˆ†æ›´æ–°</h1>
        
        <div class="success">
            <h3>ğŸ‰ Webhook å¤„ç†æˆåŠŸï¼</h3>
            <p>ä»æ—¥å¿—å¯ä»¥çœ‹åˆ°æ”¯ä»˜å¤„ç†å®Œå…¨æˆåŠŸï¼š</p>
            <ul>
                <li>âœ… ç”¨æˆ·åŒ¹é…: nfkmr920@gmail.com â†’ 84335d21-b801-4ce3-90af-71f7d14e47f9</li>
                <li>âœ… æ”¯ä»˜è®°å½•: ObjectId('694a6a5b28ab3641ff3acc6b')</li>
                <li>âœ… ç§¯åˆ†æ›´æ–°: 0 + 1000 = 1000</li>
            </ul>
        </div>

        <div class="info">
            <h3>ğŸ“‹ é‡è¦è¯´æ˜</h3>
            <p><strong>ç§¯åˆ†å­˜å‚¨ä½ç½®</strong>: ç§¯åˆ†å­˜å‚¨åœ¨ <strong>Supabase</strong> çš„ user_metadata ä¸­ï¼Œä¸æ˜¯ MongoDBï¼</p>
            <ul>
                <li><strong>MongoDB</strong>: å­˜å‚¨æ”¯ä»˜è®°å½•</li>
                <li><strong>Supabase</strong>: å­˜å‚¨ç”¨æˆ·ç§¯åˆ†</li>
            </ul>
        </div>

        <h3>ğŸ” éªŒè¯æ–¹æ³•</h3>

        <div class="result">
            <h4>æ–¹æ³•1: æ£€æŸ¥å‰ç«¯æ˜¾ç¤º</h4>
            <p>åˆ·æ–°ä½ çš„åº”ç”¨é¡µé¢ï¼ŒæŸ¥çœ‹ç§¯åˆ†æ˜¾ç¤ºç»„ä»¶æ˜¯å¦æ˜¾ç¤º 1000 ç§¯åˆ†ã€‚</p>
            <button class="button" onclick="checkLocalStorage()">æ£€æŸ¥æœ¬åœ°å­˜å‚¨</button>
        </div>

        <div class="result">
            <h4>æ–¹æ³•2: æŸ¥çœ‹ Supabase åå°</h4>
            <ol>
                <li>ç™»å½• <a href="https://supabase.com/dashboard" target="_blank">Supabase Dashboard</a></li>
                <li>è¿›å…¥ä½ çš„é¡¹ç›®</li>
                <li>ç‚¹å‡» "Authentication" â†’ "Users"</li>
                <li>æ‰¾åˆ°é‚®ç®±ä¸º <code>nfkmr920@gmail.com</code> çš„ç”¨æˆ·</li>
                <li>æŸ¥çœ‹ <code>user_metadata</code> å­—æ®µ</li>
            </ol>
            <p>åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„æ•°æ®ï¼š</p>
            <div class="code">{"credits": 1000}</div>
        </div>

        <div class="result">
            <h4>æ–¹æ³•3: æ£€æŸ¥ MongoDB æ”¯ä»˜è®°å½•</h4>
            <p>åœ¨ MongoDB ä¸­æŸ¥çœ‹æ”¯ä»˜è®°å½•ï¼š</p>
            <div class="code">
// æŸ¥çœ‹æœ€æ–°çš„æ”¯ä»˜è®°å½•
db.payments.find().sort({createdAt: -1}).limit(5)

// æŸ¥çœ‹ç‰¹å®šçš„æ”¯ä»˜è®°å½•
db.payments.findOne({_id: ObjectId("694a6a5b28ab3641ff3acc6b")})
            </div>
            <p>åº”è¯¥èƒ½çœ‹åˆ°å®Œæ•´çš„æ”¯ä»˜è®°å½•ï¼ŒåŒ…å«ç”¨æˆ·IDå’Œç§¯åˆ†ä¿¡æ¯ã€‚</p>
        </div>

        <h3>ğŸ“Š éªŒè¯ç»“æœ</h3>
        <div id="verification-results"></div>

        <div class="info">
            <h3>ğŸ¯ æ€»ç»“</h3>
            <p>æ”¯ä»˜ç³»ç»Ÿå·¥ä½œå®Œå…¨æ­£å¸¸ï¼ç§¯åˆ†å·²ç»æˆåŠŸæ·»åŠ åˆ°ç”¨æˆ·è´¦æˆ·ã€‚å¦‚æœå‰ç«¯æ²¡æœ‰æ˜¾ç¤ºæ›´æ–°çš„ç§¯åˆ†ï¼Œå¯èƒ½éœ€è¦ï¼š</p>
            <ul>
                <li>åˆ·æ–°é¡µé¢æˆ–é‡æ–°ç™»å½•</li>
                <li>æ£€æŸ¥å‰ç«¯ç§¯åˆ†è·å–é€»è¾‘</li>
                <li>ç¡®è®¤ CreditsDisplay ç»„ä»¶æ­£ç¡®è¯»å– user_metadata</li>
            </ul>
        </div>
    </div>

    <script>
        function checkLocalStorage() {
            const userStr = localStorage.getItem('user');
            const resultsDiv = document.getElementById('verification-results');
            
            if (!userStr) {
                resultsDiv.innerHTML = `
                    <div class="result">
                        <h4>âŒ æœ¬åœ°å­˜å‚¨æ£€æŸ¥</h4>
                        <p>localStorage ä¸­æ²¡æœ‰ç”¨æˆ·ä¿¡æ¯ã€‚è¯·å…ˆç™»å½•ã€‚</p>
                    </div>
                `;
                return;
            }

            try {
                const user = JSON.parse(userStr);
                const credits = user.user_metadata?.credits || 0;
                const email = user.email;
                
                resultsDiv.innerHTML = `
                    <div class="result">
                        <h4>ğŸ“Š æœ¬åœ°å­˜å‚¨æ£€æŸ¥ç»“æœ</h4>
                        <p><strong>ç”¨æˆ·é‚®ç®±:</strong> ${email}</p>
                        <p><strong>å½“å‰ç§¯åˆ†:</strong> ${credits}</p>
                        <p><strong>çŠ¶æ€:</strong> ${credits >= 1000 ? 'âœ… ç§¯åˆ†å·²æ›´æ–°' : 'âš ï¸ ç§¯åˆ†å¯èƒ½éœ€è¦åˆ·æ–°'}</p>
                        
                        ${credits < 1000 ? `
                            <div style="background: #fff3cd; padding: 10px; border-radius: 4px; margin-top: 10px;">
                                <strong>ğŸ’¡ å»ºè®®:</strong> å¦‚æœç§¯åˆ†æ˜¾ç¤ºä¸æ­£ç¡®ï¼Œè¯·å°è¯•ï¼š
                                <ul>
                                    <li>åˆ·æ–°é¡µé¢</li>
                                    <li>é‡æ–°ç™»å½•</li>
                                    <li>æ£€æŸ¥ Supabase åå°ç¡®è®¤ç§¯åˆ†å·²æ›´æ–°</li>
                                </ul>
                            </div>
                        ` : ''}
                        
                        <details style="margin-top: 15px;">
                            <summary>æŸ¥çœ‹å®Œæ•´ç”¨æˆ·æ•°æ®</summary>
                            <div class="code">${JSON.stringify(user, null, 2)}</div>
                        </details>
                    </div>
                `;
            } catch (e) {
                resultsDiv.innerHTML = `
                    <div class="result">
                        <h4>âŒ è§£æé”™è¯¯</h4>
                        <p>æ— æ³•è§£æç”¨æˆ·æ•°æ®: ${e.message}</p>
                    </div>
                `;
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ” ç§¯åˆ†éªŒè¯å·¥å…·åˆå§‹åŒ–');
            
            // æ˜¾ç¤ºæˆåŠŸä¿¡æ¯
            const successInfo = `
                <div class="success">
                    <h4>âœ… Webhook å¤„ç†æˆåŠŸç¡®è®¤</h4>
                    <p>æ ¹æ®æœåŠ¡å™¨æ—¥å¿—ï¼Œæ”¯ä»˜å¤„ç†å®Œå…¨æˆåŠŸï¼š</p>
                    <ul>
                        <li>æ”¯ä»˜ID: pay_NBIcSaBhlgrJuu</li>
                        <li>ç”¨æˆ·é‚®ç®±: nfkmr920@gmail.com</li>
                        <li>ç³»ç»Ÿç”¨æˆ·ID: 84335d21-b801-4ce3-90af-71f7d14e47f9</li>
                        <li>ç§¯åˆ†æ›´æ–°: 0 â†’ 1000</li>
                        <li>æ”¯ä»˜è®°å½•: 694a6a5b28ab3641ff3acc6b</li>
                    </ul>
                </div>
            `;
            
            document.getElementById('verification-results').innerHTML = successInfo;
        });
    </script>
</body>
</html>